{"version":3,"sources":["webpack:///./src/views/vault/index.vue?e0ac","webpack:///src/common/mixin/initLiquity.vue","webpack:///./src/common/mixin/initLiquity.vue","webpack:///./src/common/mixin/initLiquity.vue?35b6","webpack:///./src/views/vault/index.vue?c59b","webpack:///./src/views/vault/index.js","webpack:///./src/views/vault","webpack:///./src/views/vault/index.vue?f72c","webpack:///./src/contactLogic/buildr/liquity.js","webpack:///./node_modules/debounce/index.js"],"names":["render","staticRenderFns","inject","data","liquityReady","AddressZero","undefinedAddress","computed","isReady","this","ethersprovider","ethChainID","isConnect","ethAddress","methods","getLiquityInstance","userAddress","account","frontendTag","useStore","setLiquityMethods","liquity","init","debounce","watch","value","created","mounted","component","_vm","_h","$createElement","_c","_self","staticClass","name","mixins","initLiquity","nav","isCreate","mapState","components","Loading","require","EthersLiquity","_connectByChainId","Percent","MINIMUM_COLLATERAL_RATIO","toString","CRITICAL_COLLATERAL_RATIO","minFeeRate","gasLimit","config","stableName","liquidationRatio","LUSD_LIQUIDATION_RESERVE","LUSD_MINIMUM_DEBT","getMaxBorrowingRate","liquityState","borrowingRate","add","fetchLiquityEntity","library","chainID","connection","getSigner","undefined","_from","getGasEstimate","depositAmount","borrowLUSDAmount","populate","openTrove","depositCollateral","borrowLUSD","tx","estimateGas","rawPopulatedTransaction","originalGasEstimate","maxBorrowingRate","send","transaction","base","closeTrove","feeFrom","original","edited","change","whatChanged","type","params","mul","Decimal","ZERO","calcTroveIndicators","debtAmount","originalTrove","trove","Trove","collateral","debt","price","setCollateral","setDebt","borrowingFee","collateralRatio","isEmpty","liquidationReserve","typeOptions","deposit","withdraw","borrow","repay","fetchAdjustBalanace","coinAmount","unit","withdrawCollateral","repayLUSD","adjustTrove","func","wait","immediate","timeout","args","context","timestamp","result","later","last","Date","now","setTimeout","apply","debounced","arguments","callNow","clear","clearTimeout","flush","module","exports"],"mappings":"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","file":"js/chunk-491c44e1.f59af22f.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=less&\"","<script>\nimport { mapState, mapActions } from 'vuex';\nimport { fetchLiquityEntity } from '@/contactLogic/buildr/liquity';\nimport { AddressZero } from '@ethersproject/constants';\nimport { EthersLiquity, _connectByChainId } from '@webfans/lib-ethers';\nimport event from '@/common/js/event';\nimport Vue from 'vue';\n\nconst debounce = require('debounce');\n\nlet isSubscribe = false;\nlet liquity;\n\nexport default {\n  inject: ['reload'],\n  data() {\n    return {\n      liquityReady: false,\n      AddressZero,\n      undefinedAddress: 'undefined'\n    };\n  },\n  computed: {\n    ...mapState(['ethersprovider', 'ethChainID', 'ethAddress']),\n    isReady() {\n      return this.ethersprovider && this.ethChainID && this.undefinedAddress;\n    },\n    isConnect() {\n      return this.ethersprovider && this.ethChainID && this.ethAddress;\n    }\n  },\n  methods: {\n    ...mapActions('buildr', ['setLiquityState']),\n    ...mapActions('pool', ['setLiquityMethods']),\n    getLiquityInstance() {\n      const provider = this.ethersprovider;\n      const account = this.ethAddress;\n      const chainId = this.ethChainID;\n\n      const connection = _connectByChainId(provider, account?provider.getSigner(account):undefined, chainId, {\n        userAddress: account,\n        frontendTag: AddressZero,\n        useStore: 'blockPolled',\n      });\n      const liquity = EthersLiquity._from(connection);\n      this.setLiquityMethods(liquity);\n    },\n    init: debounce(function() {\n      console.log('init');\n\n          const params = {\n            chainID: this.ethChainID,\n            library: this.ethersprovider,\n            account: this.ethAddress,\n          };\n          \n          \n          liquity = fetchLiquityEntity(params);\n        \n          console.log('init store');\n          liquity.store.onLoaded = () => {\n\n            this.setLiquityState(liquity.store.state);\n\n            this.liquityReady = true;\n\n            this.getLiquityInstance();\n\n            console.log(liquity.store.state);\n          };\n        if(isSubscribe === false && this.ethAddress) {\n\n\n            liquity.store.subscribe(({ newState, oldState }) => {\n              console.log(newState, oldState );\n              this.setLiquityState(newState);\n            });\n            isSubscribe = true;\n            \n        }else{\n          this.liquityReady = true;\n        }\n        liquity.store.start();\n\n      \n    },1000),\n\n\n\n  },\n  watch: {\n    isReady(value) {\n      // console.log('isReady');\n      if (value) this.init();\n    },\n    isConnect(value) {\n      // console.log('isConnect');\n      if (value) this.init();\n    }\n  },\n  created() {\n    if (this.isReady) {\n      this.init();\n    }\n  },\n  mounted() {\n    event.$on('txsuccess', () => {\n      if(this.$route.name=='lpPool'){\n        this.reload();\n      }\n\n    });\n  },\n};\n</script>\n","var render, staticRenderFns\nimport script from \"./initLiquity.vue?vue&type=script&lang=js&\"\nexport * from \"./initLiquity.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initLiquity.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initLiquity.vue?vue&type=script&lang=js&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.liquityReady)?_c('div',{staticClass:\"buildr-wrap\"},[_c('div',{staticClass:\"buildr-content\"},[_c('router-view')],1)]):_c('div',[_c('Loading')],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { mapState, mapActions } from \"vuex\";\n// import { fetchLiquityEntity } from \"../../contactLogic/buildr/liquity\";\nimport initLiquity from '@/common/mixin/initLiquity';\nexport default {\n  name: 'Vault',\n  mixins: [initLiquity],\n  data() {\n    return {\n      nav: '',\n      liquityReady: false,\n      isCreate: false,\n    };\n  },\n  computed: {\n    ...mapState(['ethersprovider', 'ethChainID', 'ethAddress']),\n    ...mapState('buildr', ['allPoolsEnable', \"isOpen\"]),\n\n    // isReady() {\n    //   return this.ethersprovider && this.ethChainID && this.ethAddress;\n    // },\n  },\n  methods: {\n    // ...mapActions('buildr', ['setLiquityState']),\n    // init() {\n    //   const params = {\n    //     chainID: this.ethChainID,\n    //     library: this.ethersprovider,\n    //     account:  this.ethAddress,\n    //   };\n    //   const liquity = fetchLiquityEntity(params);\n    //\n    //   liquity.store.onLoaded = () => {\n    //     // console.log(liquity.store.state.price.toString(), 9999)\n    //     this.liquityReady = true;\n    //     this.setLiquityState(liquity.store.state);\n    //   };\n    //\n    //   liquity.store.subscribe(({ newState, oldState }) => {\n    //     this.setLiquityState(newState);\n    //\n    //     // console.log(newState, oldState.price.toString(), newState.price.toString(), 888);\n    //     // Try to liquidate whenever the price drops\n    //     // if (newState.price.lt(oldState.price)) {\n    //     //   // tryToLiquidate(liquity);\n    //     // }\n    //   });\n    //   liquity.store.start();\n    // },\n  },\n  components: {\n    Loading: () => import(\"@/components/basic/loading.vue\"),\n  },\n  // watch: {\n  //   isReady(value) {\n  //     if(value) this.init();\n  //   }\n  // },\n  // created() {\n  //   this.nav = this.$route.name;\n  //   if (this.isReady) {\n  //     this.init();\n  //   }\n  // }\n};\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/eslint-loader/index.js??ref--13-0!./index.js?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/eslint-loader/index.js??ref--13-0!./index.js?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=ec6a0c42&\"\nimport script from \"./index.js?vue&type=script&lang=js&\"\nexport * from \"./index.js?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","const { EthersLiquity,  _connectByChainId } = require(\"@webfans/lib-ethers\");\nimport {\n  Percent,\n  Difference,\n  Decimalish,\n  Decimal,\n  Trove,\n  LiquityStoreState,\n  // LUSD_LIQUIDATION_RESERVE,\n  // LUSD_MINIMUM_DEBT, //系统最小债务\n  MINIMUM_COLLATERAL_RATIO,\n  CRITICAL_COLLATERAL_RATIO,\n} from \"@liquity/lib-base\";\nimport { AddressZero } from '@ethersproject/constants';\nimport config  from '@/config/config.js';\n\nconst mcrPercent = new Percent(MINIMUM_COLLATERAL_RATIO).toString(0);\nconst ccrPercent = new Percent(CRITICAL_COLLATERAL_RATIO).toString(0);\n\n/**********Liquity config start***************/\n// 业务地址\n// const frontendTag = '0xc7B375ce501a2432A25d584dF1f40c73c83f9534';\nconst frontendTag = AddressZero;\n// 最低费率0.5%\nconst minFeeRate = 0.005;\n// Gas Limit\nconsole.log('gasLimit');\nconst gasLimit = config.gasLimit;\nconst openGasLimit = 8000000;\n\nexport const stableName = 'LAI';\n\nconst liquidationRatio = 1.1;\n// 清算保证金\nconst LUSD_LIQUIDATION_RESERVE = 20;\n\nexport const LUSD_MINIMUM_DEBT = 200;\n\n/**********Liquity config end***************/\n\n/**\n * 获取最大借贷利率\n * */\nexport const getMaxBorrowingRate = (liquityState) => {\n  return liquityState.borrowingRate.add(minFeeRate).toString();\n};\n\n/**\n * fetch Liquity Entity\n *\n * */\nexport const fetchLiquityEntity = ({library, account, chainID}) => {\n  const connection =  _connectByChainId(library, account?library.getSigner(account):undefined, chainID, {\n    userAddress: account,\n    frontendTag,\n    useStore: \"blockPolled\"\n  });\n  // console.log(connection);\n  const liquity = EthersLiquity._from(connection);\n\n  return liquity;\n};\n\n\n/**\n * Gas Estimate\n * */\n\nexport const getGasEstimate = async ({liquity, library, account, chainID, depositAmount, borrowLUSDAmount}) => {\n  liquity = liquity || fetchLiquityEntity({library, account, chainID});\n\n  const tx = await liquity.populate.openTrove({\n    depositCollateral: depositAmount,\n    borrowLUSD: borrowLUSDAmount,\n  });\n\n  let originalGasEstimate;\n\n  try {\n    originalGasEstimate = await library.estimateGas(tx.rawPopulatedTransaction);\n    originalGasEstimate = originalGasEstimate.add(50000).toString();\n    // console.log('originalGasEstimate',originalGasEstimate, originalGasEstimate.toString(), 99999);\n  } catch (e) {\n    console.log(e, 8888);\n  }\n\n  return originalGasEstimate;\n};\n\n\n/**\n * open Trove\n * */\n\nexport const openTrove = async ({library, account, chainID, depositAmount, borrowLUSDAmount, liquityState}) => {\n  const liquity = fetchLiquityEntity({library, account, chainID});\n  const maxBorrowingRate = getMaxBorrowingRate(liquityState);\n\n  const originalGasEstimate = await getGasEstimate({liquity, library, account, chainID, depositAmount, borrowLUSDAmount});\n\n  const transaction = await liquity.send.openTrove({\n    depositCollateral: depositAmount,\n    borrowLUSD: borrowLUSDAmount,\n  }, maxBorrowingRate,{ gasLimit: originalGasEstimate });\n\n  return {\n    base: `Deposit: ${depositAmount} BNB, Debt: ${borrowLUSDAmount} ${stableName}`,\n    transaction\n  };\n};\n\n/**\n * close Trove\n * */\n\nexport const closeTrove = async ({library, account, chainID}) => {\n  const liquity = fetchLiquityEntity({library, account, chainID});\n  const transaction = await liquity.send.closeTrove({gasLimit: gasLimit});\n  return {\n    base: `Close Vault`,\n    transaction\n  };\n};\n\n\n\n/**\n * calc fee\n * liquidationReserve : 清算准备金 200 LUSD\n * price：清算价格\n * borrowingRate： 借贷利率\n * borrowingFee： 借贷费用\n * collateralRatio： 当前抵押率\n * liquidationRatio: 清算抵押率\n * */\n\nconst feeFrom  = (original, edited, borrowingRate) => {\n  const change = original.whatChanged(edited, borrowingRate);\n  if (change && change.type !== \"invalidCreation\" && change.params.borrowLUSD) {\n    return change.params.borrowLUSD.mul(borrowingRate);\n  } else {\n    return Decimal.ZERO;\n  }\n};\n\nexport const calcTroveIndicators = (liquityState, depositAmount, debtAmount) => {\n  const originalTrove = liquityState.trove;\n  let edited = new Trove(originalTrove.collateral, originalTrove.debt);\n\n  const { price, borrowingRate } = liquityState;\n\n  edited = edited.setCollateral(depositAmount);\n  edited = edited.setDebt(debtAmount);\n\n  const borrowingFee = feeFrom(originalTrove, edited, borrowingRate).toString();\n  const collateralRatio = !edited.isEmpty ? edited.collateralRatio(price).toString() : '';\n  // const originalCollateralRatio = !originalTrove.isEmpty ? originalTrove.collateralRatio(price) : undefined;\n  // const collateralRatioChange = Difference.between(collateralRatio, originalCollateralRatio);\n\n  return {\n    stableName,\n    liquidationReserve: LUSD_LIQUIDATION_RESERVE,\n    price,\n    borrowingRate,\n    borrowingFee,\n    collateralRatio,\n    liquidationRatio\n  };\n};\n\n/**\n * adjust Balance\n *\n * type:\n * deposit 存\n * Withdraw 取\n * Borrow 借\n * Repay 还\n * */\n\nconst typeOptions = {\n  deposit: 'Deposit',\n  withdraw: 'Withdraw',\n  borrow: 'Borrow',\n  repay: 'Repay',\n};\n\nexport const fetchAdjustBalanace = async ({library, account, chainID, liquityState, type, coinAmount, unit}) => {\n  const liquity = fetchLiquityEntity({library, account, chainID});\n  const maxBorrowingRate = getMaxBorrowingRate(liquityState);\n\n  let params = {};\n  switch (type) {\n    case 'deposit': params = { depositCollateral: coinAmount }; break;\n    case 'withdraw': params = { withdrawCollateral: coinAmount }; break;\n    case 'borrow': params = { borrowLUSD: coinAmount }; break;\n    case 'repay': params = { repayLUSD: coinAmount }; break;\n  }\n\n  const transaction = await liquity.send.adjustTrove(params, maxBorrowingRate,{ gasLimit });\n  return {\n    base: `${typeOptions[type]} ${coinAmount} ${unit}`,\n    transaction,\n  };\n};\n","/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n"],"sourceRoot":""}